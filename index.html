<!DOCTYPE html>
<html lang="pl">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Wykres Linii Życia Zawodowego</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;500;700&display=swap" rel="stylesheet">
    <style>
        body {
            font-family: 'Inter', sans-serif;
            background-color: #f3f4f6;
            display: flex;
            justify-content: center;
            align-items: center;
            min-height: 100vh;
        }
        .container {
            width: 95%;
            max-width: 900px;
            background-color: #ffffff;
            border-radius: 1rem;
            box-shadow: 0 10px 15px -3px rgba(0, 0, 0, 0.1), 0 4px 6px -2px rgba(0, 0, 0, 0.05);
            padding: 2rem;
            cursor: grab;
        }
        .container.dragging {
            cursor: grabbing;
        }
    </style>
</head>
<body class="bg-gray-100 flex items-center justify-center min-h-screen">
    <div id="chart-container" class="container mx-auto p-8 bg-white rounded-2xl shadow-xl">
        <h1 class="text-3xl font-bold text-center mb-6 text-gray-800">Moja Linia Życia Zawodowego</h1>
        <p class="text-center text-gray-600 mb-8">Zadowolenie z pracy na przestrzeni lat</p>
        <div class="relative h-96">
            <canvas id="lifeChart"></canvas>
        </div>
        <div class="mt-8 text-center text-sm text-gray-500">
            <p class="mb-2"><strong>Wskazówka:</strong> Możesz przeciągać punkty na wykresie w górę i w dół, aby edytować poziom zadowolenia.</p>
            <p>Oś X: Stanowiska pracy</p>
            <p>Oś Y: Poziom zadowolenia (od 0 do 10)</p>
        </div>
        <!-- Klucz kolorów -->
        <div class="flex flex-wrap justify-center mt-6 space-x-4 text-xs md:text-sm">
            <div class="flex items-center my-1">
                <div class="w-4 h-4 rounded-full mr-2" style="background-color: rgba(59, 130, 246, 1);"></div>
                Junior
            </div>
            <div class="flex items-center my-1">
                <div class="w-4 h-4 rounded-full mr-2" style="background-color: rgba(34, 197, 94, 1);"></div>
                Specjalista
            </div>
            <div class="flex items-center my-1">
                <div class="w-4 h-4 rounded-full mr-2" style="background-color: rgba(249, 115, 22, 1);"></div>
                Manager
            </div>
            <div class="flex items-center my-1">
                <div class="w-4 h-4 rounded-full mr-2" style="background-color: rgba(139, 92, 246, 1);"></div>
                Director
            </div>
        </div>
    </div>
    <script>
        document.addEventListener('DOMContentLoaded', () => {
            const chartContainer = document.getElementById('chart-container');
            const canvas = document.getElementById('lifeChart');
            const ctx = canvas.getContext('2d');

            // Dane do wykresu. Każde stanowisko ma 3 punkty.
            const initialData = [
                7, 7, 8,
                8, 9, 8,
                6, 5, 5,
                9, 10, 9
            ];

            const jobLabels = [
                'Serwisant elektronik',
                'Inżynier wsparcia technicznego',
                'Product Sales Manager',
                'Key Account Manager'
            ];
            
            // Definiowanie kolorów dla każdego stanowiska
            const colors = {
                blue: 'rgba(59, 130, 246, 1)',
                green: 'rgba(34, 197, 94, 1)',
                orange: 'rgba(249, 115, 22, 1)',
                purple: 'rgba(139, 92, 246, 1)'
            };

            const labels = [];
            let datasets = [];
            let datasetCounter = 0;

            for (let i = 0; i < initialData.length; i++) {
                // Nowe stanowisko co 3 punkty
                if (i % 3 === 0) {
                    datasets.push({
                        label: jobLabels[datasetCounter],
                        data: Array(initialData.length).fill(null), // Wypełnij nullami, aby punkty się nie łączyły
                        borderColor: Object.values(colors)[datasetCounter],
                        borderWidth: 2,
                        pointBackgroundColor: Object.values(colors)[datasetCounter],
                        pointBorderColor: '#fff',
                        pointHoverBackgroundColor: '#fff',
                        pointHoverBorderColor: Object.values(colors)[datasetCounter],
                        tension: 0.4,
                        fill: false,
                        pointRadius: 6,
                        pointHoverRadius: 8
                    });
                    datasetCounter++;
                }
                datasets[datasets.length - 1].data[i] = initialData[i];
                labels.push('');
            }

            const data = {
                labels: labels,
                datasets: datasets
            };

            const config = {
                type: 'line',
                data: data,
                options: {
                    responsive: true,
                    maintainAspectRatio: false,
                    scales: {
                        y: {
                            beginAtZero: true,
                            max: 10,
                            title: {
                                display: true,
                                text: 'Zadowolenie z pracy',
                                font: {
                                    size: 14,
                                    weight: 'bold'
                                }
                            },
                            ticks: {
                                precision: 0
                            }
                        },
                        x: {
                            title: {
                                display: true,
                                text: 'Stanowiska pracy',
                                font: {
                                    size: 14,
                                    weight: 'bold'
                                }
                            },
                            ticks: {
                                // Wyświetlanie etykiety na środku każdego segmentu
                                callback: function(val, index) {
                                    const jobIndex = Math.floor(index / 3);
                                    if ((index % 3) === 1) {
                                        return jobLabels[jobIndex];
                                    }
                                    return null;
                                }
                            }
                        }
                    },
                    plugins: {
                        tooltip: {
                            callbacks: {
                                label: function(context) {
                                    const jobTitle = context.dataset.label;
                                    let label = `Poziom zadowolenia dla: ${jobTitle}`;
                                    if (context.parsed.y !== null) {
                                        label += `: ${context.parsed.y}/10`;
                                    }
                                    return label;
                                }
                            }
                        },
                        legend: {
                            display: false
                        }
                    }
                }
            };

            const lifeChart = new Chart(ctx, config);

            // --- Logika przeciągania punktów na wykresie ---
            let isDragging = false;
            let draggedPointIndex = null;
            let draggedDatasetIndex = null;
            let oldData;

            canvas.addEventListener('mousedown', (e) => {
                const points = lifeChart.getElementsAtEventForMode(e, 'nearest', { intersect: true }, true);
                if (points.length > 0) {
                    draggedPointIndex = points[0].index;
                    draggedDatasetIndex = points[0].datasetIndex;
                    isDragging = true;
                    chartContainer.classList.add('dragging');
                }
            });

            canvas.addEventListener('mousemove', (e) => {
                if (!isDragging) return;

                const y = e.offsetY;
                const yScale = lifeChart.scales.y;
                const newValue = yScale.getValueForPixel(y);

                if (newValue >= yScale.min && newValue <= yScale.max) {
                    const dataset = lifeChart.data.datasets[draggedDatasetIndex];
                    dataset.data[draggedPointIndex] = parseFloat(newValue.toFixed(2));
                    
                    lifeChart.update();
                }
            });

            canvas.addEventListener('mouseup', () => {
                isDragging = false;
                draggedPointIndex = null;
                draggedDatasetIndex = null;
                chartContainer.classList.remove('dragging');
            });

            canvas.addEventListener('mouseout', () => {
                if (isDragging) {
                    isDragging = false;
                    draggedPointIndex = null;
                    draggedDatasetIndex = null;
                    chartContainer.classList.remove('dragging');
                }
            });
            // --- Koniec logiki przeciągania ---
        });
    </script>
</body>
</html>
